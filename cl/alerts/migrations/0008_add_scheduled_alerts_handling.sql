BEGIN;
--
-- Create model ParentAlert
--
CREATE TABLE "alerts_parentalert" ("id" integer NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "date_created" timestamp with time zone NOT NULL, "date_modified" timestamp with time zone NOT NULL, "alert_id" integer NOT NULL);
--
-- Create model UserRateAlert
--
CREATE TABLE "alerts_userratealert" ("id" integer NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "date_created" timestamp with time zone NOT NULL, "date_modified" timestamp with time zone NOT NULL, "rate" varchar(10) NOT NULL, "user_id" integer NOT NULL);
--
-- Create model ScheduledAlertHit
--
CREATE TABLE "alerts_scheduledalerthit" ("id" integer NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "date_created" timestamp with time zone NOT NULL, "date_modified" timestamp with time zone NOT NULL, "document_content" jsonb NOT NULL, "highlighted_fields" jsonb NULL, "parent_alert_id" integer NOT NULL);
--
-- Add field user_rate to parentalert
--
ALTER TABLE "alerts_parentalert" ADD COLUMN "user_rate_id" integer NOT NULL CONSTRAINT "alerts_parentalert_user_rate_id_591ba0db_fk_alerts_us" REFERENCES "alerts_userratealert"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "alerts_parentalert_user_rate_id_591ba0db_fk_alerts_us" IMMEDIATE;
--
-- Create constraint unique_user_and_rate on model userratealert
--
ALTER TABLE "alerts_userratealert" ADD CONSTRAINT "unique_user_and_rate" UNIQUE ("user_id", "rate");
ALTER TABLE "alerts_parentalert" ADD CONSTRAINT "alerts_parentalert_alert_id_774b788c_fk_alerts_alert_id" FOREIGN KEY ("alert_id") REFERENCES "alerts_alert" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "alerts_parentalert_date_created_997653b2" ON "alerts_parentalert" ("date_created");
CREATE INDEX "alerts_parentalert_date_modified_ff33a882" ON "alerts_parentalert" ("date_modified");
CREATE INDEX "alerts_parentalert_alert_id_774b788c" ON "alerts_parentalert" ("alert_id");
ALTER TABLE "alerts_userratealert" ADD CONSTRAINT "alerts_userratealert_user_id_0b22ec47_fk_auth_user_id" FOREIGN KEY ("user_id") REFERENCES "auth_user" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "alerts_userratealert_date_created_81f13909" ON "alerts_userratealert" ("date_created");
CREATE INDEX "alerts_userratealert_date_modified_a0ede336" ON "alerts_userratealert" ("date_modified");
CREATE INDEX "alerts_userratealert_user_id_0b22ec47" ON "alerts_userratealert" ("user_id");
ALTER TABLE "alerts_scheduledalerthit" ADD CONSTRAINT "alerts_scheduledaler_parent_alert_id_38bd6848_fk_alerts_pa" FOREIGN KEY ("parent_alert_id") REFERENCES "alerts_parentalert" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "alerts_scheduledalerthit_date_created_eef6e1d2" ON "alerts_scheduledalerthit" ("date_created");
CREATE INDEX "alerts_scheduledalerthit_date_modified_085e80b9" ON "alerts_scheduledalerthit" ("date_modified");
CREATE INDEX "alerts_scheduledalerthit_parent_alert_id_38bd6848" ON "alerts_scheduledalerthit" ("parent_alert_id");
CREATE INDEX "alerts_parentalert_user_rate_id_591ba0db" ON "alerts_parentalert" ("user_rate_id");
COMMIT;
