{% extends "user_prayers_list.html" %}
{% load extras %}
{% load text_filters %}
{% load static %}
{% load pacer %}
{% load tz %}
{% load humanize %}

{% block nav-prayer-pending %}active{% endblock %}

{% if is_page_owner %}
<div class="recap-email-toggle text-center" hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'>
  <label for="auto-subscribe"><b>Make pending prayers public: </b></label>
  <div id="switch-button" class="toggle btn {% if auto_subscribe %}btn-primary {% else %} btn-light off {% endif %}"
       hx-post="{% url "toggle_prayer_public" %}"
       hx-swap="none" hx-include="[name=current_toggle_status]"
       data-toggle="toggle" role="button">
    <input name="current_toggle_status" type="hidden" value="{{ page_public }}"/>
    <div class="toggle-group">
      <label for="auto-subscribe" class="btn btn-primary toggle-on">On</label>
      <label for="auto-subscribe" class="btn btn-light toggle-off">Off</label>
      <span class="toggle-handle btn btn-light"></span>
    </div>
  </div>
</div>
{% endif %}

{% block prayer_list %}
  <div class="col-xs-12" id="prayer_list_waiting" hx-swap-oob="true">
    <div class="table-responsive">
      <table class="settings-table table">
        <thead>
            <tr>
              <th>Court</th>
              <th>Case Name</th>
              <th>Document Number</th>
              <th>Document Description</th>
              <th>Requested On</th>
              {% if is_page_owner %}<th>Delete</th>{% endif %}
            </tr>
        </thead>
        <tbody>
            {% for rd in rd_with_prayers_waiting %}
            <tr>
              <td>{{ rd.docket_entry.docket.court.citation_string }}</td>
              {% with docket=rd.docket_entry.docket %}
              <td>
                <a href="{% url "view_docket" docket.pk docket.slug %}">
                  {{ docket|best_case_name|safe|v_wrapper }} ({{ docket.docket_number }})
                </a>
              </td>
              <td>
                <a href="{% url "view_recap_document" docket.pk rd.docket_entry.entry_number docket.slug %}">
                  {{ rd.document_number }}
                </a>
              </td>
              {% endwith %}
              <td>{{ rd.description }}</td>
              <td>{{ rd.prayer_date_created|date:"M j, Y" }}</td>
              {% if is_page_owner %}
                <td>
                  <div class="flex justify-content-center">
                    <form id="pray_{{rd.pk}}" hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}' hx-swap="none"
                      hx-post="{% url 'delete_prayer' rd.pk %}" hx-indicator="#delete-spinner-{{rd.pk}}">
                      <input type="hidden" name="source" value="user_prayer_list">
                      <button class="btn btn-danger btn-xs">
                        <i class="fa fa-trash-o"></i>
                      </button>
                    </form>
                    &nbsp;
                    <span id="delete-spinner-{{rd.pk}}" class="htmx-hidden-indicator" >
                      <i class="fa fa-spinner fa-spin fa-lg"></i>
                    </span>
                  </div>
                </td>
              {% endif %}
            </tr>
            {% empty %}
            <tr>
                <td colspan="2">No document requests pending. Consider making one!</td>
            </tr>
            {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  {% if rd_with_prayers_waiting.has_other_pages %}
  <div class="col-xs-12" >
    {% include "includes/pagination.html" with page_obj=rd_with_prayers_waiting %}
  </div>
  {% endif %}

{% endblock %}
